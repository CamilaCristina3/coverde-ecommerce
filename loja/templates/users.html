{% extends "base.html" %}
{% load static %}

{% block title %}Perfil - COVERDE{% endblock %}

{% block content %}
<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-lg-8">

      <!-- ‚úÖ Cabe√ßalho do perfil -->
      <div class="bg-white p-4 rounded shadow-sm mb-4 d-flex align-items-center gap-4">
        {% if user.foto_perfil %}
          <img src="{{ user.foto_perfil.url }}" alt="Foto de Perfil" class="rounded-circle" width="100" height="100">
        {% else %}
          <img src="{% static 'imgs/icons/iconperson.svg' %}" alt="Sem foto" class="rounded-circle" width="100">
        {% endif %}
        <div>
          <h3 class="fw-bold mb-1">{{ user.primeiro_nome }} {{ user.ultimo_nome }}</h3>
          <p class="text-muted mb-0">{{ user.perfil|capfirst }}</p>
          {% if user.localidade %}
            <small class="text-muted">üìç {{ user.localidade }}</small>
          {% endif %}
        </div>
      </div>

      <!-- ‚úÖ Descri√ß√£o -->
      {% if user.descricao %}
        <div class="mb-4">
          <h5 class="fw-bold">Sobre</h5>
          <p>{{ user.descricao }}</p>
        </div>
      {% endif %}

      <!-- ‚úÖ A√ß√µes -->
      <div class="mb-5 d-flex gap-3">
        <a href="{% url 'upload_product' %}" class="btn btn-orange rounded-pill">‚ûï Novo Produto</a>
        <a href="{% url 'logout' %}" class="btn btn-outline-danger rounded-pill">Terminar Sess√£o</a>
      </div>

      <!-- ‚úÖ Lista de Produtos (se for produtor) -->
      {% if user.perfil == "produtor" and produtos %}
        <h4 class="fw-bold mb-3">üì¶ Os teus Produtos</h4>
        <div class="row g-4">
          {% for produto in produtos %}
            <div class="col-md-4">
              <div class="card h-100 shadow-sm border-0">
                {% with imagem=produto.imagens.first %}
                  {% if imagem %}
                    <img src="{{ imagem.imagem.url }}" class="card-img-top" alt="{{ produto.nome }}">
                  {% else %}
                    <img src="{% static 'imgs/placeholder.jpg' %}" class="card-img-top" alt="Imagem indispon√≠vel">
                  {% endif %}
                {% endwith %}
                <div class="card-body d-flex flex-column">
                  <h5 class="card-title">{{ produto.nome }}</h5>
                  <p class="text-muted">{{ produto.quantidade }} ‚Äî <strong>{{ produto.preco }} ‚Ç¨</strong></p>
                  <a href="{% url 'produto_detail' produto.id %}" class="btn btn-outline-success mt-auto">Ver detalhes</a>
                </div>
              </div>
            </div>
          {% endfor %}
        </div>
      {% elif user.perfil == "produtor" %}
        <p class="text-muted">Ainda n√£o publicaste nenhum produto.</p>
      {% endif %}

    </div>
  </div>
</div>
{% endblock %}
